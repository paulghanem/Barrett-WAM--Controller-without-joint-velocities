function x = statespace5(q,qd,tau);
DH_a = [0 0 0.045 -0.045 0 0 0];
    DH_d = [0 0 .55 0 0.3 0 0.061];
    DH_alpha = [-pi/2 pi/2 -pi/2 pi/2 -pi/2 pi/2 0];

    m = [10.7676 3.87 1.8022 2.4 0.1237 0.4979886 0.07548270];
    
     
    
    com = zeros(3,7);
   com(:,1) = [-0.00443422; 0.12189039; -0.00066489];
    com(:,2) = [-0.00236983; 0.03105614; 0.01542114 ];
    com(:,3) = [-0.03825858; 0.20750770; 0.00003309];
    com(:,4) = [ 0.00498512;-0.00022942;0.13271662 ];
    com(:,5) = [0.00008921;0.00511217;0.00435824];
    com(:,6) = [-0.00012262;-0.01703194;0.02468336];
    com(:,7) = [-0.00007974;0.00016313;-0.00323552 ];
     
      hand_mass = 1.385;
        DH_d(7) = DH_d(7) + .0953; % Adding the distance to the hand frame for the Schunk Gripper
        com(:,7) = (com(:,7).*hand_mass + com(:,7).*m(7))/(hand_mass + m(7)); % Finding the combined center of mass
        m(7) = m(7) + hand_mass;  
    
     I(:,:,1) = [ 0.29486350 , -0.00795023 ,-0.00009311;
                 -0.00795023 , 0.11350017 , -0.00018711;
                -0.00009311 , -0.00018711 , 0.25065343];
    I(:,:,2) =[0.02606840 ,-0.00001346 , -0.00011701;
               -0.00001346,  0.01472202 ,0.00003659;
               -0.00011701 , 0.00003659,  0.01934814];
    I(:,:,3) = [0.13671601,  -0.01680434,  0.00000510;
               -0.01680434 , 0.00588354 , -0.00000530;
                0.00000510 , -0.00000530 , 0.13951371];
    I(:,:,4) = [ 0.05719268 , 0.00001467 , 0.00008193;
                 0.00001467 , 0.05716470 , -0.00009417;
                 0.00008193 , -0.00009417 , 0.00300441] ;
    I(:,:,5) =[0.00005587 , 0.00000026,  0.00000000;
               0.00000026 , 0.00007817,  -0.00000083;
               0.00000000 , -0.00000083,  0.00006594];
    I(:,:,6) = [0.00093106,  0.00000148 , -0.00000201;
                0.00000148,  0.00049833 , -0.00022162;
               -0.00000201,  -0.00022162,  0.00057483];
    I(:,:,7) = [ 0.003167342,          0,         0;       % Approximate Inertia Tensor for Schunk Gripper
                              0, 0.001128942,         0;
                              0,          0, 0.00258007;];  
             T = zeros(4,4,7);
             
for j=1:7,
        a = DH_a(j);
        d = DH_d(j);
        alpha = DH_alpha(j);
        T(:,:,j) = getTransformDH(a, d, alpha, q(j));
end 
A = zeros(4,4,7);
A(:,:,1) = T(:,:,1);
A(:,:,2) = A(:,:,1)*T(:,:,2);
A(:,:,3) = A(:,:,2)*T(:,:,3);
A(:,:,4) = A(:,:,3)*T(:,:,4);
A(:,:,5) = A(:,:,4)*T(:,:,5);
A(:,:,6) = A(:,:,5)*T(:,:,6);
A(:,:,7) = A(:,:,6)*T(:,:,7);

R = zeros(4,4,7,7);
for i=1:7,
    for p=1:7,
        if i <= p
            if i == 1,  
                R(:,:,p,i)= A(:,:,p);
            else 
 
            b=i-1;
            
            R(:,:,p,i)= inv(A(:,:,b))*A(:,:,p);
            end 
        else 
         end 
    end 
end 

   comstar = zeros(4,7);
    comstar(:,1) = [com(:,1);1];
    comstar(:,2) = [com(:,2);1];
    comstar(:,3) = [com(:,3);1];
    comstar(:,4) = [com(:,4);1];
    comstar(:,5) = [com(:,5);1];
    comstar(:,6) = [com(:,6);1];
    comstar(:,7) = [ com(:,7);1];
  
    Q=[0,-1,0,0;
     1,0,0,0;
     0,0,0,0;
     0,0,0,0];
   
 gravity=[0,0,-9.81,0];
 
   G(1)= -m(1)*gravity*Q*T(:,:,1)*comstar(:,1)-m(2)*gravity*Q*T(:,:,1)*T(:,:,2)*comstar(:,2)-m(3)*gravity*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*comstar(:,3)-m(4)*gravity*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*comstar(:,4)-m(5)*gravity*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*comstar(:,5)-m(6)*gravity*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*comstar(:,6)-m(7)*gravity*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7)*comstar(:,7);   
   G(2)= -m(2)*gravity*T(:,:,1)*Q*T(:,:,2)*comstar(:,2)-m(3)*gravity*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*comstar(:,3)-m(4)*gravity*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*comstar(:,4)-m(5)*gravity*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*comstar(:,5)-m(6)*gravity*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*comstar(:,6)-m(7)*gravity*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7)*comstar(:,7);
   G(3)= -m(3)*gravity*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*comstar(:,3)-m(4)*gravity*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*comstar(:,4)-m(5)*gravity*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*comstar(:,5)-m(6)*gravity*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*comstar(:,6)-m(7)*gravity*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7)*comstar(:,7);
   G(4)= -m(4)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*comstar(:,4)-m(5)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*comstar(:,5)-m(6)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*comstar(:,6)-m(7)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7)*comstar(:,7);
   G(5)= -m(5)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*comstar(:,5)-m(6)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*comstar(:,6)-m(7)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7)*comstar(:,7);
   G(6)= -m(6)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*comstar(:,6)-m(7)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7)*comstar(:,7);
   G(7)= -m(7)*gravity*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7)*comstar(:,7);
   
   U(:,:,1,1)= Q*T(:,:,1);
   U(:,:,2,1)= Q*T(:,:,1)*T(:,:,2);
   U(:,:,3,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3);
   U(:,:,4,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4);
   U(:,:,5,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,6,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,7,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   
   
   U(:,:,2,2)= T(:,:,1)*Q*T(:,:,2);
   U(:,:,3,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3);
   U(:,:,4,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4);
   U(:,:,5,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,6,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,7,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   
  
   U(:,:,3,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3);
   U(:,:,4,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4);
   U(:,:,5,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,6,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,7,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   
   U(:,:,4,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4);
   U(:,:,5,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5);
   U(:,:,6,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,7,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   
   U(:,:,5,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5);
   U(:,:,6,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,7,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   
   U(:,:,6,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,7,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   
   U(:,:,7,7)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   
   
   
  
   
 
   
   J(:,:,1)=[0.5*(-I(1,1,1)+I(2,2,1)+I(3,3,1)), I(1,2,1), I(1,3,1), m(1)*com(1,1);
             I(1,2,1) ,0.5*(I(1,1,1)-I(2,2,1)+I(3,3,1)), I(2,3,1), m(1)*com(2,1);
             I(1,3,1), I(2,3,1), 0.5*(I(1,1,1)+I(2,2,1)-I(3,3,1)), m(1)*com(3,1);
              m(1)*com(1,1), m(1)*com(2,1), m(1)*com(3,1), m(1)];
   
    J(:,:,2)=[0.5*(-I(1,1,2)+I(2,2,2)+I(3,3,2)), I(1,2,2), I(1,3,2), m(2)*com(1,2);
             I(1,2,2) ,0.5*(I(1,1,2)-I(2,2,2)+I(3,3,2)), I(2,3,2), m(2)*com(2,2);
             I(1,3,2), I(2,3,2), 0.5*(I(1,1,2)+I(2,2,2)-I(3,3,2)), m(2)*com(3,2);
              m(2)*com(1,2), m(2)*com(2,2), m(2)*com(3,2), m(2)];
   
          
     J(:,:,3)=[0.5*(-I(1,1,3)+I(2,2,3)+I(3,3,3)), I(1,2,3), I(1,3,3), m(3)*com(1,3);
             I(1,2,3) ,0.5*(I(1,1,3)-I(2,2,3)+I(3,3,3)), I(2,3,3), m(3)*com(2,3);
             I(1,3,3), I(2,3,3), 0.5*(I(1,1,3)+I(2,2,3)-I(3,3,3)), m(3)*com(3,3);
              m(3)*com(1,3), m(3)*com(2,3), m(3)*com(3,3), m(3)];      
   
   
    J(:,:,4)=[0.5*(-I(1,1,4)+I(2,2,4)+I(3,3,4)), I(1,2,4), I(1,3,4), m(4)*com(1,4);
             I(1,2,4) ,0.5*(I(1,1,4)-I(2,2,4)+I(3,3,4)), I(2,3,4), m(4)*com(2,4);
             I(1,3,4), I(2,3,4), 0.5*(I(1,1,4)+I(2,2,4)-I(3,3,4)), m(4)*com(3,4);
              m(4)*com(1,4), m(4)*com(2,4), m(4)*com(3,4), m(4)];
   
   
    J(:,:,5)=[0.5*(-I(1,1,5)+I(2,2,5)+I(3,3,5)), I(1,2,5), I(1,3,5), m(5)*com(1,5);
             I(1,2,5) ,0.5*(I(1,1,5)-I(2,2,5)+I(3,3,5)), I(2,3,5), m(5)*com(2,5);
             I(1,3,5), I(2,3,5), 0.5*(I(1,1,5)+I(2,2,5)-I(3,3,5)), m(5)*com(3,5);
              m(5)*com(1,5), m(5)*com(2,5), m(5)*com(3,5), m(5)];
   
   
    J(:,:,6)=[0.5*(-I(1,1,6)+I(2,2,6)+I(3,3,6)), I(1,2,6), I(1,3,6), m(6)*com(1,6);
             I(1,2,6) ,0.5*(I(1,1,6)-I(2,2,6)+I(3,3,6)), I(2,3,6), m(6)*com(2,6);
             I(1,3,6), I(2,3,6), 0.5*(I(1,1,6)+I(2,2,6)-I(3,3,6)), m(6)*com(3,6);
              m(6)*com(1,6), m(6)*com(2,6), m(6)*com(3,6), m(6)];
   
   
    J(:,:,7)=[0.5*(-I(1,1,7)+I(2,2,7)+I(3,3,7)), I(1,2,7), I(1,3,7), m(7)*com(1,7);
             I(1,2,7) ,0.5*(I(1,1,7)-I(2,2,7)+I(3,3,7)), I(2,3,7), m(7)*com(2,7);
             I(1,3,7), I(2,3,7), 0.5*(I(1,1,7)+I(2,2,7)-I(3,3,7)), m(7)*com(3,7);
              m(7)*com(1,7), m(7)*com(2,7), m(7)*com(3,7), m(7)];
   
   
    D(1,1)= trace(U(:,:,1,1)*J(:,:,1)*transpose(U(:,:,1,1))) + trace(U(:,:,2,1)*J(:,:,2)*transpose(U(:,:,2,1))) + trace(U(:,:,3,1)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,1)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,1)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,1)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,1)*J(:,:,7)*transpose(U(:,:,7,1))) ;
    D(1,2)= trace(U(:,:,2,2)*J(:,:,2)*transpose(U(:,:,2,1))) + trace(U(:,:,3,2)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,2)*J(:,:,4)*transpose(U(:,:,4,1))) +trace(U(:,:,5,2)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,2)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,2)*J(:,:,7)*transpose(U(:,:,7,1))); 
    D(1,3)= trace(U(:,:,3,3)*J(:,:,3)*transpose(U(:,:,3,1)))+ trace(U(:,:,4,3)*J(:,:,4)*transpose(U(:,:,4,1)))+ trace(U(:,:,5,3)*J(:,:,5)*transpose(U(:,:,5,1)))+ trace(U(:,:,6,3)*J(:,:,6)*transpose(U(:,:,6,1)))+ trace(U(:,:,7,3)*J(:,:,7)*transpose(U(:,:,7,1))); 
    D(1,4)= trace(U(:,:,4,4)*J(:,:,4)*transpose(U(:,:,4,1)))+ trace(U(:,:,5,4)*J(:,:,5)*transpose(U(:,:,5,1)))+ trace(U(:,:,6,4)*J(:,:,6)*transpose(U(:,:,6,1)))+ trace(U(:,:,7,4)*J(:,:,7)*transpose(U(:,:,7,1)));
    D(1,5)= trace(U(:,:,5,5)*J(:,:,5)*transpose(U(:,:,5,1)))+ trace(U(:,:,6,5)*J(:,:,6)*transpose(U(:,:,6,1)))+ trace(U(:,:,7,5)*J(:,:,7)*transpose(U(:,:,7,1)));
    D(1,6)= trace(U(:,:,6,6)*J(:,:,6)*transpose(U(:,:,6,1)))+ trace(U(:,:,7,6)*J(:,:,7)*transpose(U(:,:,7,1)));
    D(1,7)= trace(U(:,:,7,7)*J(:,:,7)*transpose(U(:,:,7,1)));
    
    D(2,1)= trace(U(:,:,2,1)*J(:,:,2)*transpose(U(:,:,2,2)))+ trace(U(:,:,3,1)*J(:,:,3)*transpose(U(:,:,3,2)))+ trace(U(:,:,4,1)*J(:,:,4)*transpose(U(:,:,4,2)))+ trace(U(:,:,5,1)*J(:,:,5)*transpose(U(:,:,5,2)))+ trace(U(:,:,6,1)*J(:,:,6)*transpose(U(:,:,6,2)))+ trace(U(:,:,7,1)*J(:,:,7)*transpose(U(:,:,7,2)));
    D(2,2)= trace(U(:,:,2,2)*J(:,:,2)*transpose(U(:,:,2,2)))+ trace(U(:,:,3,2)*J(:,:,3)*transpose(U(:,:,3,2)))+ trace(U(:,:,4,2)*J(:,:,4)*transpose(U(:,:,4,2)))+ trace(U(:,:,5,2)*J(:,:,5)*transpose(U(:,:,5,2)))+ trace(U(:,:,6,2)*J(:,:,6)*transpose(U(:,:,6,2)))+ trace(U(:,:,7,2)*J(:,:,7)*transpose(U(:,:,7,2)));
    D(2,3)= trace(U(:,:,3,3)*J(:,:,3)*transpose(U(:,:,3,2)))+ trace(U(:,:,4,3)*J(:,:,4)*transpose(U(:,:,4,2)))+ trace(U(:,:,5,3)*J(:,:,5)*transpose(U(:,:,5,2)))+ trace(U(:,:,6,3)*J(:,:,6)*transpose(U(:,:,6,2)))+ trace(U(:,:,7,3)*J(:,:,7)*transpose(U(:,:,7,2))); 
    D(2,4)= trace(U(:,:,4,4)*J(:,:,4)*transpose(U(:,:,4,2)))+ trace(U(:,:,5,4)*J(:,:,5)*transpose(U(:,:,5,2)))+ trace(U(:,:,6,4)*J(:,:,6)*transpose(U(:,:,6,2)))+ trace(U(:,:,7,4)*J(:,:,7)*transpose(U(:,:,7,2))); 
    D(2,5)= trace(U(:,:,5,5)*J(:,:,5)*transpose(U(:,:,5,2)))+ trace(U(:,:,6,5)*J(:,:,6)*transpose(U(:,:,6,2)))+ trace(U(:,:,7,5)*J(:,:,7)*transpose(U(:,:,7,2)));
    D(2,6)= trace(U(:,:,6,6)*J(:,:,6)*transpose(U(:,:,6,2)))+ trace(U(:,:,7,6)*J(:,:,7)*transpose(U(:,:,7,2))); 
    D(2,7)= trace(U(:,:,7,7)*J(:,:,7)*transpose(U(:,:,7,2)));
  
    D(3,1)= trace(U(:,:,3,1)*J(:,:,3)*transpose(U(:,:,3,3)))+ trace(U(:,:,4,1)*J(:,:,4)*transpose(U(:,:,4,3)))+ trace(U(:,:,5,1)*J(:,:,5)*transpose(U(:,:,5,3)))+ trace(U(:,:,6,1)*J(:,:,6)*transpose(U(:,:,6,3)))+ trace(U(:,:,7,1)*J(:,:,7)*transpose(U(:,:,7,3)));
    D(3,2)= trace(U(:,:,3,2)*J(:,:,3)*transpose(U(:,:,3,3)))+ trace(U(:,:,4,2)*J(:,:,4)*transpose(U(:,:,4,3)))+ trace(U(:,:,5,2)*J(:,:,5)*transpose(U(:,:,5,3)))+ trace(U(:,:,6,2)*J(:,:,6)*transpose(U(:,:,6,3)))+ trace(U(:,:,7,2)*J(:,:,7)*transpose(U(:,:,7,3)));
    D(3,3)= trace(U(:,:,3,3)*J(:,:,3)*transpose(U(:,:,3,3)))+ trace(U(:,:,4,3)*J(:,:,4)*transpose(U(:,:,4,3)))+ trace(U(:,:,5,3)*J(:,:,5)*transpose(U(:,:,5,3)))+ trace(U(:,:,6,3)*J(:,:,6)*transpose(U(:,:,6,3)))+ trace(U(:,:,7,3)*J(:,:,7)*transpose(U(:,:,7,3)));
    D(3,4)= trace(U(:,:,4,4)*J(:,:,4)*transpose(U(:,:,4,3)))+ trace(U(:,:,5,4)*J(:,:,5)*transpose(U(:,:,5,3)))+ trace(U(:,:,6,4)*J(:,:,6)*transpose(U(:,:,6,3)))+ trace(U(:,:,7,4)*J(:,:,7)*transpose(U(:,:,7,3)));
    D(3,5)= trace(U(:,:,5,5)*J(:,:,5)*transpose(U(:,:,5,3)))+ trace(U(:,:,6,5)*J(:,:,6)*transpose(U(:,:,6,3)))+ trace(U(:,:,7,5)*J(:,:,7)*transpose(U(:,:,7,3)));
    D(3,6)= trace(U(:,:,6,6)*J(:,:,6)*transpose(U(:,:,6,3)))+ trace(U(:,:,7,6)*J(:,:,7)*transpose(U(:,:,7,3)));
    D(3,7)= trace(U(:,:,7,7)*J(:,:,7)*transpose(U(:,:,7,3)));
     
     
    D(4,1)= trace(U(:,:,4,1)*J(:,:,4)*transpose(U(:,:,4,4)))+ trace(U(:,:,5,1)*J(:,:,5)*transpose(U(:,:,5,4)))+ trace(U(:,:,6,1)*J(:,:,6)*transpose(U(:,:,6,4)))+ trace(U(:,:,7,1)*J(:,:,7)*transpose(U(:,:,7,4))); 
    D(4,2)= trace(U(:,:,4,2)*J(:,:,4)*transpose(U(:,:,4,4)))+ trace(U(:,:,5,2)*J(:,:,5)*transpose(U(:,:,5,4)))+ trace(U(:,:,6,2)*J(:,:,6)*transpose(U(:,:,6,4)))+ trace(U(:,:,7,2)*J(:,:,7)*transpose(U(:,:,7,4))); 
    D(4,3)= trace(U(:,:,4,3)*J(:,:,4)*transpose(U(:,:,4,4)))+ trace(U(:,:,5,3)*J(:,:,5)*transpose(U(:,:,5,4)))+ trace(U(:,:,6,3)*J(:,:,6)*transpose(U(:,:,6,4)))+ trace(U(:,:,7,3)*J(:,:,7)*transpose(U(:,:,7,4)));
    D(4,4)= trace(U(:,:,4,4)*J(:,:,4)*transpose(U(:,:,4,4)))+ trace(U(:,:,5,4)*J(:,:,5)*transpose(U(:,:,5,4)))+ trace(U(:,:,6,4)*J(:,:,6)*transpose(U(:,:,6,4)))+ trace(U(:,:,7,4)*J(:,:,7)*transpose(U(:,:,7,4)));
    D(4,5)= trace(U(:,:,5,5)*J(:,:,5)*transpose(U(:,:,5,4)))+ trace(U(:,:,6,5)*J(:,:,6)*transpose(U(:,:,6,4)))+ trace(U(:,:,7,5)*J(:,:,7)*transpose(U(:,:,7,4)));
    D(4,6)= trace(U(:,:,6,6)*J(:,:,6)*transpose(U(:,:,6,4)))+ trace(U(:,:,7,6)*J(:,:,7)*transpose(U(:,:,7,4))); 
    D(4,7)= trace(U(:,:,7,7)*J(:,:,7)*transpose(U(:,:,7,4)));
    
    D(5,1)= trace(U(:,:,5,1)*J(:,:,5)*transpose(U(:,:,5,5)))+ trace(U(:,:,6,1)*J(:,:,6)*transpose(U(:,:,6,5)))+ trace(U(:,:,7,1)*J(:,:,7)*transpose(U(:,:,7,5)));
    D(5,2)= trace(U(:,:,5,2)*J(:,:,5)*transpose(U(:,:,5,5)))+ trace(U(:,:,6,2)*J(:,:,6)*transpose(U(:,:,6,5)))+ trace(U(:,:,7,2)*J(:,:,7)*transpose(U(:,:,7,5)));
    D(5,3)= trace(U(:,:,5,3)*J(:,:,5)*transpose(U(:,:,5,5)))+ trace(U(:,:,6,3)*J(:,:,6)*transpose(U(:,:,6,5)))+ trace(U(:,:,7,3)*J(:,:,7)*transpose(U(:,:,7,5))); 
    D(5,4)= trace(U(:,:,5,4)*J(:,:,5)*transpose(U(:,:,5,5)))+ trace(U(:,:,6,4)*J(:,:,6)*transpose(U(:,:,6,5)))+ trace(U(:,:,7,4)*J(:,:,7)*transpose(U(:,:,7,5))); 
    D(5,5)= trace(U(:,:,5,5)*J(:,:,5)*transpose(U(:,:,5,5)))+ trace(U(:,:,6,5)*J(:,:,6)*transpose(U(:,:,6,5)))+ trace(U(:,:,7,5)*J(:,:,7)*transpose(U(:,:,7,5)));
    D(5,6)= trace(U(:,:,6,6)*J(:,:,6)*transpose(U(:,:,6,5)))+ trace(U(:,:,7,6)*J(:,:,7)*transpose(U(:,:,7,5))); 
    D(5,7)= trace(U(:,:,7,7)*J(:,:,7)*transpose(U(:,:,7,5)));
    
    D(6,1)= trace(U(:,:,6,1)*J(:,:,6)*transpose(U(:,:,6,6)))+ trace(U(:,:,7,1)*J(:,:,7)*transpose(U(:,:,7,6)));
    D(6,2)= trace(U(:,:,6,2)*J(:,:,6)*transpose(U(:,:,6,6)))+ trace(U(:,:,7,2)*J(:,:,7)*transpose(U(:,:,7,6)));
    D(6,3)= trace(U(:,:,6,3)*J(:,:,6)*transpose(U(:,:,6,6)))+ trace(U(:,:,7,3)*J(:,:,7)*transpose(U(:,:,7,6))); 
    D(6,4)= trace(U(:,:,6,4)*J(:,:,6)*transpose(U(:,:,6,6)))+ trace(U(:,:,7,4)*J(:,:,7)*transpose(U(:,:,7,6))); 
    D(6,5)= trace(U(:,:,6,5)*J(:,:,6)*transpose(U(:,:,6,6)))+ trace(U(:,:,7,5)*J(:,:,7)*transpose(U(:,:,7,6))); 
    D(6,6)= trace(U(:,:,6,6)*J(:,:,6)*transpose(U(:,:,6,6)))+ trace(U(:,:,7,6)*J(:,:,7)*transpose(U(:,:,7,6))); 
    D(6,7)= trace(U(:,:,7,7)*J(:,:,7)*transpose(U(:,:,7,6)));
    
    D(7,1)= trace(U(:,:,7,1)*J(:,:,7)*transpose(U(:,:,7,7)));
    D(7,2)= trace(U(:,:,7,2)*J(:,:,7)*transpose(U(:,:,7,7)));
    D(7,3)= trace(U(:,:,7,3)*J(:,:,7)*transpose(U(:,:,7,7)));
    D(7,4)= trace(U(:,:,7,4)*J(:,:,7)*transpose(U(:,:,7,7)));
    D(7,5)= trace(U(:,:,7,5)*J(:,:,7)*transpose(U(:,:,7,7)));
    D(7,6)= trace(U(:,:,7,6)*J(:,:,7)*transpose(U(:,:,7,7)));
    D(7,7)= trace(U(:,:,7,7)*J(:,:,7)*transpose(U(:,:,7,7)));
   
    %friction
    s=20;
bc = [2.516; 2.581; 2.038; 0.956; 0.323; 0.315; 0.066];
B =  [1.142; 0.946; 0.309; 0.255; 0.025; 0.039; 0.004];

bq = bc.*atan(s*qd)*2/pi+B.*qd;

   
%coriolis:

   U(:,:,1,1,1)= Q*Q*T(:,:,1);
   U(:,:,1,1,2)= 0;
   U(:,:,1,1,3)= 0;
   U(:,:,1,1,4)= 0;
   U(:,:,1,1,5)= 0;
   U(:,:,1,1,6)= 0;
   U(:,:,1,1,7)= 0;
   
   U(:,:,1,2,1)= 0;
   U(:,:,1,2,2)= 0;
   U(:,:,1,2,3)= 0;
   U(:,:,1,2,4)= 0;
   U(:,:,1,2,5)= 0;
   U(:,:,1,2,6)= 0;
   U(:,:,1,2,7)= 0;
 
   U(:,:,1,3,1)= 0;
   U(:,:,1,3,2)= 0;
   U(:,:,1,3,3)= 0;
   U(:,:,1,3,4)= 0;
   U(:,:,1,3,5)= 0;
   U(:,:,1,3,6)= 0;
   U(:,:,1,3,7)= 0;
   
   
   U(:,:,1,4,1)= 0;
   U(:,:,1,4,2)= 0;
   U(:,:,1,4,3)= 0;
   U(:,:,1,4,4)= 0;
   U(:,:,1,4,5)= 0;
   U(:,:,1,4,6)= 0;
   U(:,:,1,4,7)= 0;
   
   U(:,:,1,5,1)= 0;
   U(:,:,1,5,2)= 0;
   U(:,:,1,5,3)= 0;
   U(:,:,1,5,4)= 0;
   U(:,:,1,5,5)= 0;
   U(:,:,1,5,6)= 0;
   U(:,:,1,5,7)= 0;
   
   U(:,:,1,6,1)= 0;
   U(:,:,1,6,2)= 0;
   U(:,:,1,6,3)= 0;
   U(:,:,1,6,4)= 0;
   U(:,:,1,6,5)= 0;
   U(:,:,1,6,6)= 0;
   U(:,:,1,6,7)= 0;
   
   U(:,:,1,7,1)= 0;
   U(:,:,1,7,2)= 0;
   U(:,:,1,7,3)= 0;
   U(:,:,1,7,4)= 0;
   U(:,:,1,7,5)= 0;
   U(:,:,1,7,6)= 0;
   U(:,:,1,7,7)= 0;
  
   
   
   U(:,:,2,1,1)= Q*Q*T(:,:,1)*T(:,:,2);
   U(:,:,2,1,2)= Q*T(:,:,1)*Q*T(:,:,2);
   U(:,:,2,1,3)=0 ;
   U(:,:,2,1,4)=0 ;
   U(:,:,2,1,5)=0 ;
   U(:,:,2,1,6)=0 ;
   U(:,:,2,1,7)=0 ;
   
   U(:,:,2,2,1)= Q*T(:,:,1)*Q*T(:,:,2);
   U(:,:,2,2,2)= T(:,:,1)*Q*Q*T(:,:,2);
   U(:,:,2,2,3)= 0;
   U(:,:,2,2,4)= 0;
   U(:,:,2,2,5)= 0;
   U(:,:,2,2,6)= 0;
   U(:,:,2,2,7)= 0;
   
   U(:,:,2,3,1)= 0;
   U(:,:,2,3,2)= 0;
   U(:,:,2,3,3)= 0;
   U(:,:,2,3,4)= 0;
   U(:,:,2,3,5)= 0;
   U(:,:,2,3,6)= 0;
   U(:,:,2,3,7)= 0;
   
   U(:,:,2,4,1)= 0;
   U(:,:,2,4,2)= 0;
   U(:,:,2,4,3)= 0;
   U(:,:,2,4,4)= 0;
   U(:,:,2,4,5)= 0;
   U(:,:,2,4,6)= 0;
   U(:,:,2,4,7)= 0;
   
   U(:,:,2,5,1)= 0;
   U(:,:,2,5,2)= 0;
   U(:,:,2,5,3)= 0;
   U(:,:,2,5,4)= 0;
   U(:,:,2,5,5)= 0;
   U(:,:,2,5,6)= 0;
   U(:,:,2,5,7)= 0;
   
   U(:,:,2,6,1)= 0;
   U(:,:,2,6,2)= 0;
   U(:,:,2,6,3)= 0;
   U(:,:,2,6,4)= 0;
   U(:,:,2,6,5)= 0;
   U(:,:,2,6,6)= 0;
   U(:,:,2,6,7)= 0;
   
   U(:,:,2,7,1)= 0;
   U(:,:,2,7,2)= 0;
   U(:,:,2,7,3)= 0;
   U(:,:,2,7,4)= 0;
   U(:,:,2,7,5)= 0;
   U(:,:,2,7,6)= 0;
   U(:,:,2,7,7)= 0;
   
   
   U(:,:,3,1,1)= Q*Q*T(:,:,1)*T(:,:,2)*T(:,:,3);
   U(:,:,3,1,2)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3);
   U(:,:,3,1,3)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3);
   U(:,:,3,1,4)= 0;
   U(:,:,3,1,5)= 0;
   U(:,:,3,1,6)= 0;
   U(:,:,3,1,7)= 0;
   
   U(:,:,3,2,1)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3);
   U(:,:,3,2,2)= T(:,:,1)*Q*Q*T(:,:,2)*T(:,:,3);
   U(:,:,3,2,3)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3);
   U(:,:,3,2,4)= 0;
   U(:,:,3,2,5)= 0;
   U(:,:,3,2,6)= 0;
   U(:,:,3,2,7)= 0;
   
   U(:,:,3,3,1)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3);
   U(:,:,3,3,2)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3);
   U(:,:,3,3,3)= T(:,:,1)*T(:,:,2)*Q*Q*T(:,:,3);
   U(:,:,3,3,4)= 0;
   U(:,:,3,3,5)= 0;
   U(:,:,3,3,6)= 0;
   U(:,:,3,3,7)= 0;
   
   U(:,:,3,4,1)= 0;
   U(:,:,3,4,2)= 0;
   U(:,:,3,4,3)= 0;
   U(:,:,3,4,4)= 0;
   U(:,:,3,4,5)= 0;
   U(:,:,3,4,6)= 0;
   U(:,:,3,4,7)= 0;
  
   U(:,:,3,5,1)= 0;
   U(:,:,3,5,2)= 0;
   U(:,:,3,5,3)= 0;
   U(:,:,3,5,4)= 0;
   U(:,:,3,5,5)= 0;
   U(:,:,3,5,6)= 0;
   U(:,:,3,5,7)= 0;
   
   U(:,:,3,6,1)= 0;
   U(:,:,3,6,2)= 0;
   U(:,:,3,6,3)= 0;
   U(:,:,3,6,4)= 0;
   U(:,:,3,6,5)= 0;
   U(:,:,3,6,6)= 0;
   U(:,:,3,6,7)= 0;
   
   U(:,:,3,7,1)= 0;
   U(:,:,3,7,2)= 0;
   U(:,:,3,7,3)= 0;
   U(:,:,3,7,4)= 0;
   U(:,:,3,7,5)= 0;
   U(:,:,3,7,6)= 0;
   U(:,:,3,7,7)= 0;
   
   U(:,:,4,1,1)= Q*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4);
   U(:,:,4,1,2)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4);
   U(:,:,4,1,3)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4);
   U(:,:,4,1,4)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4);
   U(:,:,4,1,5)= 0;
   U(:,:,4,1,6)= 0;
   U(:,:,4,1,7)= 0;
   
   U(:,:,4,2,1)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4);
   U(:,:,4,2,2)= T(:,:,1)*Q*Q*T(:,:,2)*T(:,:,3)*T(:,:,4);
   U(:,:,4,2,3)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4);
   U(:,:,4,2,4)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4);
   U(:,:,4,2,5)= 0;
   U(:,:,4,2,6)= 0;
   U(:,:,4,2,7)= 0;
   
   U(:,:,4,3,1)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4);
   U(:,:,4,3,2)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4);
   U(:,:,4,3,3)= T(:,:,1)*T(:,:,2)*Q*Q*T(:,:,3)*T(:,:,4);
   U(:,:,4,3,4)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4); 
   U(:,:,4,3,5)= 0;
   U(:,:,4,3,6)= 0;
   U(:,:,4,3,7)= 0;
   
   U(:,:,4,4,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4);
   U(:,:,4,4,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4);
   U(:,:,4,4,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4);
   U(:,:,4,4,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*Q*T(:,:,4);
   U(:,:,4,4,5)= 0;
   U(:,:,4,4,6)= 0;
   U(:,:,4,4,7)= 0;
   
   U(:,:,4,5,1)= 0;
   U(:,:,4,5,2)= 0;
   U(:,:,4,5,3)= 0;
   U(:,:,4,5,4)= 0;
   U(:,:,4,5,5)= 0;
   U(:,:,4,5,6)= 0;
   U(:,:,4,5,7)= 0;
   
   U(:,:,4,6,1)= 0;
   U(:,:,4,6,2)= 0;
   U(:,:,4,6,3)= 0;
   U(:,:,4,6,4)= 0;
   U(:,:,4,6,5)= 0;
   U(:,:,4,6,6)= 0;
   U(:,:,4,6,7)= 0;
   
   U(:,:,4,7,1)= 0;
   U(:,:,4,7,2)= 0;
   U(:,:,4,7,3)= 0;
   U(:,:,4,7,4)= 0;
   U(:,:,4,7,5)= 0;
   U(:,:,4,7,6)= 0;
   U(:,:,4,7,7)= 0;
   
   U(:,:,5,1,1)= Q*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,1,2)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,1,3)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,1,4)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5);
   U(:,:,5,1,5)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,1,6)= 0;
   U(:,:,5,1,7)= 0;
   
   U(:,:,5,2,1)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,2,2)= T(:,:,1)*Q*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,2,3)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,2,4)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5);
   U(:,:,5,2,5)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,2,6)= 0 ;
   U(:,:,5,2,7)= 0 ;
   
   U(:,:,5,3,1)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,3,2)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,3,3)= T(:,:,1)*T(:,:,2)*Q*Q*T(:,:,3)*T(:,:,4)*T(:,:,5);
   U(:,:,5,3,4)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4)*T(:,:,5);
   U(:,:,5,3,5)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,3,6)= 0 ;
   U(:,:,5,3,7)= 0 ;
   
   
   U(:,:,5,4,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5);
   U(:,:,5,4,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5);
   U(:,:,5,4,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4)*T(:,:,5);
   U(:,:,5,4,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*Q*T(:,:,4)*T(:,:,5);
   U(:,:,5,4,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,4,6)= 0 ;
   U(:,:,5,4,7)= 0 ;
   
   U(:,:,5,5,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,5,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,5,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,5,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*Q*T(:,:,5);
   U(:,:,5,5,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*Q*T(:,:,5);
   U(:,:,5,5,6)= 0 ;
   U(:,:,5,5,7)= 0 ;

   
   U(:,:,5,6,1)= 0 ;
   U(:,:,5,6,2)= 0 ;
   U(:,:,5,6,3)= 0 ;
   U(:,:,5,6,4)= 0 ;
   U(:,:,5,6,5)= 0 ;
   U(:,:,5,6,6)= 0 ;
   U(:,:,5,6,7)= 0 ;
  
   U(:,:,5,7,1)= 0 ;
   U(:,:,5,7,2)= 0 ;
   U(:,:,5,7,3)= 0 ;
   U(:,:,5,7,4)= 0 ;
   U(:,:,5,7,5)= 0 ;
   U(:,:,5,7,6)= 0 ;
   U(:,:,5,7,7)= 0 ;
   
   U(:,:,6,1,1)= Q*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,1,2)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,1,3)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,1,4)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,1,5)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,1,6)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,1,7)= 0;
   
   U(:,:,6,2,1)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,2,2)= T(:,:,1)*Q*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,2,3)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,2,4)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,2,5)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,2,6)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,2,7)= 0 ;
   
   U(:,:,6,3,1)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,3,2)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,3,3)= T(:,:,1)*T(:,:,2)*Q*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,3,4)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,3,5)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,3,6)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,3,7)= 0 ;
   
   U(:,:,6,4,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,4,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,4,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,4,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*Q*T(:,:,4)*T(:,:,5)*T(:,:,6);
   U(:,:,6,4,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,4,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,4,7)= 0 ;
   
   U(:,:,6,5,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,5,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,5,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,5,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,5,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*Q*T(:,:,5)*T(:,:,6);
   U(:,:,6,5,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,5,7)= 0 ;
   
   U(:,:,6,6,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,6,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6); 
   U(:,:,6,6,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,6,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*Q*T(:,:,6);
   U(:,:,6,6,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*Q*T(:,:,6); 
   U(:,:,6,6,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*Q*T(:,:,6);  
   U(:,:,6,6,7)= 0;  
   
   U(:,:,6,7,1)= 0 ;
   U(:,:,6,7,2)= 0 ;
   U(:,:,6,7,3)= 0 ;
   U(:,:,6,7,4)= 0 ;
   U(:,:,6,7,5)= 0 ;
   U(:,:,6,7,6)= 0 ;
   U(:,:,6,7,7)= 0 ;
   
   
   U(:,:,7,1,1)= Q*Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,1,2)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,1,3)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,1,4)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,1,5)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,1,6)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,1,7)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   
   U(:,:,7,2,1)= Q*T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,2,2)= T(:,:,1)*Q*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,2,3)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,2,4)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,2,5)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,2,6)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,2,7)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   
   U(:,:,7,3,1)= Q*T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,3,2)= T(:,:,1)*Q*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,3,3)= T(:,:,1)*T(:,:,2)*Q*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,3,4)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,3,5)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,3,6)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,3,7)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   
   U(:,:,7,4,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,4,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,4,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,4,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,4,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,4,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,4,7)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   
   U(:,:,7,5,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,5,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,5,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,5,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,5,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*Q*T(:,:,5)*T(:,:,6)*T(:,:,7);
   U(:,:,7,5,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,5,7)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   
   
   U(:,:,7,6,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,6,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,6,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,6,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,6,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,6,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*Q*T(:,:,6)*T(:,:,7);
   U(:,:,7,6,7)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*Q*T(:,:,7);
   
   
   U(:,:,7,7,1)= Q*T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   U(:,:,7,7,2)= T(:,:,1)*Q*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   U(:,:,7,7,3)= T(:,:,1)*T(:,:,2)*Q*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7); 
   U(:,:,7,7,4)= T(:,:,1)*T(:,:,2)*T(:,:,3)*Q*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   U(:,:,7,7,5)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*Q*T(:,:,5)*T(:,:,6)*Q*T(:,:,7);
   U(:,:,7,7,6)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*Q*T(:,:,6)*Q*T(:,:,7); 
   U(:,:,7,7,7)= T(:,:,1)*T(:,:,2)*T(:,:,3)*T(:,:,4)*T(:,:,5)*T(:,:,6)*Q*Q*T(:,:,7);

   
C(1,1,1)= trace(U(:,:,1,1,1)*J(:,:,1)*transpose(U(:,:,1,1))) + trace(U(:,:,2,1,1)*J(:,:,2)*transpose(U(:,:,2,1))) + trace(U(:,:,3,1,1)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,1,1)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,1,1)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,1,1)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,1,1)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,1,2)= trace(U(:,:,2,1,2)*J(:,:,2)*transpose(U(:,:,2,1))) + trace(U(:,:,3,1,2)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,1,2)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,1,2)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,1,2)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,1,2)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,1,3)= trace(U(:,:,3,1,3)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,1,3)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,1,3)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,1,3)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,1,3)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,1,4)= trace(U(:,:,4,1,4)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,1,4)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,1,4)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,1,4)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,1,5)= trace(U(:,:,5,1,5)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,1,5)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,1,5)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,1,6)= trace(U(:,:,6,1,6)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,1,6)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,1,7)= trace(U(:,:,7,1,7)*J(:,:,7)*transpose(U(:,:,7,1))); 

C(1,2,1)= trace(U(:,:,2,2,1)*J(:,:,2)*transpose(U(:,:,2,1))) + trace(U(:,:,3,2,1)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,2,1)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,2,1)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,2,1)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,2,1)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,2,2)= trace(U(:,:,2,2,2)*J(:,:,2)*transpose(U(:,:,2,1))) + trace(U(:,:,3,2,2)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,2,2)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,2,2)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,2,2)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,2,2)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,2,3)= trace(U(:,:,3,2,3)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,2,3)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,2,3)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,2,3)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,2,3)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,2,4)= trace(U(:,:,4,2,4)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,2,4)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,2,4)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,2,4)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,2,5)= trace(U(:,:,5,2,5)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,2,5)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,2,5)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,2,6)= trace(U(:,:,6,2,6)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,2,6)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,2,7)= trace(U(:,:,7,2,7)*J(:,:,7)*transpose(U(:,:,7,1))); 


C(1,3,1)= trace(U(:,:,3,3,1)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,3,1)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,3,1)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,3,1)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,3,1)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,3,2)= trace(U(:,:,3,3,2)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,3,2)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,3,2)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,3,2)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,3,2)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,3,3)= trace(U(:,:,3,3,3)*J(:,:,3)*transpose(U(:,:,3,1))) + trace(U(:,:,4,3,3)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,3,3)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,3,3)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,3,3)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,3,4)= trace(U(:,:,4,3,4)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,3,4)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,3,4)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,3,4)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,3,5)= trace(U(:,:,5,3,5)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,3,5)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,3,5)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,3,6)= trace(U(:,:,6,3,6)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,3,6)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,3,7)= trace(U(:,:,7,3,7)*J(:,:,7)*transpose(U(:,:,7,1))); 


C(1,4,1)= trace(U(:,:,4,4,1)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,4,1)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,4,1)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,4,1)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,4,2)= trace(U(:,:,4,4,2)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,4,2)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,4,2)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,4,2)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,4,3)= trace(U(:,:,4,4,3)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,4,3)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,4,3)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,4,3)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,4,4)= trace(U(:,:,4,4,4)*J(:,:,4)*transpose(U(:,:,4,1))) + trace(U(:,:,5,4,4)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,4,4)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,4,4)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,4,5)= trace(U(:,:,5,4,5)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,4,5)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,4,5)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,4,6)= trace(U(:,:,6,4,6)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,4,6)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,4,7)= trace(U(:,:,7,4,7)*J(:,:,7)*transpose(U(:,:,7,1))); 



C(1,5,1)= trace(U(:,:,5,5,1)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,5,1)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,5,1)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,5,2)= trace(U(:,:,5,5,2)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,5,2)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,5,2)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,5,3)= trace(U(:,:,5,5,3)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,5,3)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,5,3)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,5,4)= trace(U(:,:,5,5,4)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,5,4)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,5,4)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,5,5)= trace(U(:,:,5,5,5)*J(:,:,5)*transpose(U(:,:,5,1))) + trace(U(:,:,6,5,5)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,5,5)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,5,6)= trace(U(:,:,6,5,6)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,5,6)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,5,7)= trace(U(:,:,7,5,7)*J(:,:,7)*transpose(U(:,:,7,1))); 

C(1,6,1)= trace(U(:,:,6,6,1)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,6,1)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,6,2)= trace(U(:,:,6,6,2)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,6,2)*J(:,:,7)*transpose(U(:,:,7,1)));  
C(1,6,3)= trace(U(:,:,6,6,3)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,6,3)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,6,4)= trace(U(:,:,6,6,4)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,6,4)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,6,5)= trace(U(:,:,6,6,5)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,6,5)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,6,6)= trace(U(:,:,6,6,6)*J(:,:,6)*transpose(U(:,:,6,1))) + trace(U(:,:,7,6,6)*J(:,:,7)*transpose(U(:,:,7,1))); 
C(1,6,7)= trace(U(:,:,7,6,7)*J(:,:,7)*transpose(U(:,:,7,1)));

C(1,7,1)= trace(U(:,:,7,7,1)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,7,2)= trace(U(:,:,7,7,2)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,7,3)= trace(U(:,:,7,7,3)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,7,4)= trace(U(:,:,7,7,4)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,7,5)= trace(U(:,:,7,7,5)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,7,6)= trace(U(:,:,7,7,6)*J(:,:,7)*transpose(U(:,:,7,1)));
C(1,7,7)= trace(U(:,:,7,7,7)*J(:,:,7)*transpose(U(:,:,7,1)));

C(2,1,1)= trace(U(:,:,2,1,1)*J(:,:,2)*transpose(U(:,:,2,2))) + trace(U(:,:,3,1,1)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,1,1)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,1,1)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,1,1)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,1,1)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,1,2)= trace(U(:,:,2,1,2)*J(:,:,2)*transpose(U(:,:,2,2))) + trace(U(:,:,3,1,2)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,1,2)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,1,2)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,1,2)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,1,2)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,1,3)= trace(U(:,:,3,1,3)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,1,3)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,1,3)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,1,3)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,1,3)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,1,4)= trace(U(:,:,4,1,4)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,1,4)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,1,4)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,1,4)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,1,5)= trace(U(:,:,5,1,5)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,1,5)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,1,5)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,1,6)= trace(U(:,:,6,1,6)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,1,6)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,1,7)= trace(U(:,:,7,1,7)*J(:,:,7)*transpose(U(:,:,7,2)));

C(2,2,1)= trace(U(:,:,2,2,1)*J(:,:,2)*transpose(U(:,:,2,2))) + trace(U(:,:,3,2,1)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,2,1)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,2,1)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,2,1)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,2,1)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,2,2)= trace(U(:,:,2,2,2)*J(:,:,2)*transpose(U(:,:,2,2))) + trace(U(:,:,3,2,2)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,2,2)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,2,2)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,2,2)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,2,2)*J(:,:,7)*transpose(U(:,:,7,2))); 
C(2,2,3)= trace(U(:,:,3,2,3)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,2,3)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,2,3)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,2,3)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,2,3)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,2,4)= trace(U(:,:,4,2,4)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,2,4)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,2,4)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,2,4)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,2,5)= trace(U(:,:,5,2,5)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,2,5)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,2,5)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,2,6)= trace(U(:,:,6,2,6)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,2,6)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,2,7)= trace(U(:,:,7,2,7)*J(:,:,7)*transpose(U(:,:,7,2)));


C(2,3,1)= trace(U(:,:,3,3,1)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,3,1)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,3,1)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,3,1)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,3,1)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,3,2)= trace(U(:,:,3,3,2)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,3,2)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,3,2)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,3,2)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,3,2)*J(:,:,7)*transpose(U(:,:,7,2))) ; 
C(2,3,3)= trace(U(:,:,3,3,3)*J(:,:,3)*transpose(U(:,:,3,2))) + trace(U(:,:,4,3,3)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,3,3)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,3,3)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,3,3)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,3,4)= trace(U(:,:,4,3,4)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,3,4)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,3,4)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,3,4)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,3,5)= trace(U(:,:,5,3,5)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,3,5)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,3,5)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,3,6)= trace(U(:,:,6,3,6)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,3,6)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,3,7)= trace(U(:,:,7,3,7)*J(:,:,7)*transpose(U(:,:,7,2)));

C(2,4,1)= trace(U(:,:,4,4,1)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,4,1)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,4,1)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,4,1)*J(:,:,7)*transpose(U(:,:,7,2))) ;
C(2,4,2)= trace(U(:,:,4,4,2)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,4,2)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,4,2)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,4,2)*J(:,:,7)*transpose(U(:,:,7,2))) ; 
C(2,4,3)= trace(U(:,:,4,4,3)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,4,3)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,4,3)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,4,3)*J(:,:,7)*transpose(U(:,:,7,2))) ; 
C(2,4,4)= trace(U(:,:,4,4,4)*J(:,:,4)*transpose(U(:,:,4,2))) + trace(U(:,:,5,4,4)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,4,4)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,4,4)*J(:,:,7)*transpose(U(:,:,7,2))) ; 
C(2,4,5)= trace(U(:,:,5,4,5)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,4,5)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,4,5)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,4,6)= trace(U(:,:,6,4,6)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,4,6)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,4,7)= trace(U(:,:,7,4,7)*J(:,:,7)*transpose(U(:,:,7,2)));


C(2,5,1)= trace(U(:,:,5,5,1)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,5,1)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,5,1)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,5,2)= trace(U(:,:,5,5,2)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,5,2)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,5,2)*J(:,:,7)*transpose(U(:,:,7,2))); 
C(2,5,3)= trace(U(:,:,5,5,3)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,5,3)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,5,3)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,5,4)= trace(U(:,:,5,5,4)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,5,4)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,5,4)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,5,5)= trace(U(:,:,5,5,5)*J(:,:,5)*transpose(U(:,:,5,2))) + trace(U(:,:,6,5,5)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,5,5)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,5,6)= trace(U(:,:,6,5,6)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,5,6)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,5,7)= trace(U(:,:,7,5,7)*J(:,:,7)*transpose(U(:,:,7,2)));


C(2,6,1)= trace(U(:,:,6,6,1)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,6,1)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,6,2)= trace(U(:,:,6,6,2)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,6,2)*J(:,:,7)*transpose(U(:,:,7,2))); 
C(2,6,3)= trace(U(:,:,6,6,3)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,6,3)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,6,4)= trace(U(:,:,6,6,4)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,6,4)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,6,5)= trace(U(:,:,6,6,5)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,6,5)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,6,6)= trace(U(:,:,6,6,6)*J(:,:,6)*transpose(U(:,:,6,2))) + trace(U(:,:,7,6,6)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,6,7)= trace(U(:,:,7,6,7)*J(:,:,7)*transpose(U(:,:,7,2)));

C(2,7,1)= trace(U(:,:,7,7,1)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,7,2)= trace(U(:,:,7,7,2)*J(:,:,7)*transpose(U(:,:,7,2))); 
C(2,7,3)= trace(U(:,:,7,7,3)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,7,4)= trace(U(:,:,7,7,4)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,7,5)= trace(U(:,:,7,7,5)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,7,6)= trace(U(:,:,7,7,6)*J(:,:,7)*transpose(U(:,:,7,2)));
C(2,7,7)= trace(U(:,:,7,7,7)*J(:,:,7)*transpose(U(:,:,7,2)));

C(3,1,1)= trace(U(:,:,3,1,1)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,1,1)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,1,1)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,1,1)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,1,1)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,1,2)= trace(U(:,:,3,1,2)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,1,2)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,1,2)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,1,2)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,1,2)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,1,3)= trace(U(:,:,3,1,3)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,1,3)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,1,3)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,1,3)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,1,3)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,1,4)= trace(U(:,:,4,1,4)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,1,4)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,1,4)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,1,4)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,1,5)= trace(U(:,:,5,1,5)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,1,5)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,1,5)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,1,6)= trace(U(:,:,6,1,6)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,1,6)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,1,7)= trace(U(:,:,7,1,7)*J(:,:,7)*transpose(U(:,:,7,3))) ;

C(3,2,1)= trace(U(:,:,3,2,1)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,2,1)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,2,1)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,2,1)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,2,1)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,2,2)= trace(U(:,:,3,2,2)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,2,2)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,2,2)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,2,2)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,2,2)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,2,3)= trace(U(:,:,3,2,3)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,2,3)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,2,3)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,2,3)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,2,3)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,2,4)= trace(U(:,:,4,2,4)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,2,4)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,2,4)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,2,4)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,2,5)= trace(U(:,:,5,2,5)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,2,5)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,2,5)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,2,6)= trace(U(:,:,6,2,6)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,2,6)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,2,7)= trace(U(:,:,7,2,7)*J(:,:,7)*transpose(U(:,:,7,3))) ;

C(3,3,1)= trace(U(:,:,3,3,1)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,3,1)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,3,1)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,3,1)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,3,1)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,3,2)= trace(U(:,:,3,3,2)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,3,2)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,3,2)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,3,2)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,3,2)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,3,3)= trace(U(:,:,3,3,3)*J(:,:,3)*transpose(U(:,:,3,3))) + trace(U(:,:,4,3,3)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,3,3)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,3,3)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,3,3)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,3,4)= trace(U(:,:,4,3,4)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,3,4)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,3,4)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,3,4)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,3,5)= trace(U(:,:,5,3,5)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,3,5)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,3,5)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,3,6)= trace(U(:,:,6,3,6)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,3,6)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,3,7)= trace(U(:,:,7,3,7)*J(:,:,7)*transpose(U(:,:,7,3))) ;

C(3,4,1)= trace(U(:,:,4,4,1)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,4,1)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,4,1)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,4,1)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,4,2)= trace(U(:,:,4,4,2)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,4,2)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,4,2)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,4,2)*J(:,:,7)*transpose(U(:,:,7,3))) ; 
C(3,4,3)= trace(U(:,:,4,4,3)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,4,3)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,4,3)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,4,3)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,4,4)= trace(U(:,:,4,4,4)*J(:,:,4)*transpose(U(:,:,4,3))) + trace(U(:,:,5,4,4)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,4,4)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,4,4)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,4,5)= trace(U(:,:,5,4,5)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,4,5)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,4,5)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,4,6)= trace(U(:,:,6,4,6)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,4,6)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,4,7)= trace(U(:,:,7,4,7)*J(:,:,7)*transpose(U(:,:,7,3))) ;


C(3,5,1)= trace(U(:,:,5,5,1)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,5,1)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,5,1)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,5,2)= trace(U(:,:,5,5,2)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,5,2)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,5,2)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,5,3)= trace(U(:,:,5,5,3)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,5,3)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,5,3)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,5,4)= trace(U(:,:,5,5,4)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,5,4)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,5,4)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,5,5)= trace(U(:,:,5,5,5)*J(:,:,5)*transpose(U(:,:,5,3))) + trace(U(:,:,6,5,5)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,5,5)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,5,6)= trace(U(:,:,6,5,6)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,5,6)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,5,7)= trace(U(:,:,7,5,7)*J(:,:,7)*transpose(U(:,:,7,3))) ;

C(3,6,1)= trace(U(:,:,6,6,1)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,6,1)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,6,2)= trace(U(:,:,6,6,2)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,6,2)*J(:,:,7)*transpose(U(:,:,7,3))) ; 
C(3,6,3)= trace(U(:,:,6,6,3)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,6,3)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,6,4)= trace(U(:,:,6,6,4)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,6,4)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,6,5)= trace(U(:,:,6,6,5)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,6,5)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,6,6)= trace(U(:,:,6,6,6)*J(:,:,6)*transpose(U(:,:,6,3))) + trace(U(:,:,7,6,6)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,6,7)= trace(U(:,:,7,6,7)*J(:,:,7)*transpose(U(:,:,7,3))) ;

C(3,7,1)= trace(U(:,:,7,7,1)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,7,2)= trace(U(:,:,7,7,2)*J(:,:,7)*transpose(U(:,:,7,3))) ; 
C(3,7,3)= trace(U(:,:,7,7,3)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,7,4)= trace(U(:,:,7,7,4)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,7,5)= trace(U(:,:,7,7,5)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,7,6)= trace(U(:,:,7,7,6)*J(:,:,7)*transpose(U(:,:,7,3))) ;
C(3,7,7)= trace(U(:,:,7,7,7)*J(:,:,7)*transpose(U(:,:,7,3))) ;

C(4,1,1)= trace(U(:,:,4,1,1)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,1,1)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,1,1)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,1,1)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,1,2)= trace(U(:,:,4,1,2)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,1,2)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,1,2)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,1,2)*J(:,:,7)*transpose(U(:,:,7,4))) ; 
C(4,1,3)= trace(U(:,:,4,1,3)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,1,3)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,1,3)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,1,3)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,1,4)= trace(U(:,:,4,1,4)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,1,4)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,1,4)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,1,4)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,1,5)= trace(U(:,:,5,1,5)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,1,5)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,1,5)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,1,6)= trace(U(:,:,6,1,6)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,1,6)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,1,7)= trace(U(:,:,7,1,7)*J(:,:,7)*transpose(U(:,:,7,4))) ;

C(4,2,1)= trace(U(:,:,4,2,1)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,2,1)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,2,1)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,2,1)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,2,2)= trace(U(:,:,4,2,2)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,2,2)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,2,2)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,2,2)*J(:,:,7)*transpose(U(:,:,7,4))) ; 
C(4,2,3)= trace(U(:,:,4,2,3)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,2,3)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,2,3)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,2,3)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,2,4)= trace(U(:,:,4,2,4)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,2,4)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,2,4)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,2,4)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,2,5)= trace(U(:,:,5,2,5)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,2,5)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,2,5)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,2,6)= trace(U(:,:,6,2,6)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,2,6)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,2,7)= trace(U(:,:,7,2,7)*J(:,:,7)*transpose(U(:,:,7,4))) ;

C(4,3,1)= trace(U(:,:,4,3,1)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,3,1)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,3,1)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,3,1)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,3,2)= trace(U(:,:,4,3,2)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,3,2)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,3,2)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,3,2)*J(:,:,7)*transpose(U(:,:,7,4))) ; 
C(4,3,3)= trace(U(:,:,4,3,3)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,3,3)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,3,3)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,3,3)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,3,4)= trace(U(:,:,4,3,4)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,3,4)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,3,4)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,3,4)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,3,5)= trace(U(:,:,5,3,5)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,3,5)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,3,5)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,3,6)= trace(U(:,:,6,3,6)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,3,6)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,3,7)= trace(U(:,:,7,3,7)*J(:,:,7)*transpose(U(:,:,7,4))) ;

C(4,4,1)= trace(U(:,:,4,4,1)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,4,1)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,4,1)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,4,1)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,4,2)= trace(U(:,:,4,4,2)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,4,2)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,4,2)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,4,2)*J(:,:,7)*transpose(U(:,:,7,4))) ; 
C(4,4,3)= trace(U(:,:,4,4,3)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,4,3)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,4,3)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,4,3)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,4,4)= trace(U(:,:,4,4,4)*J(:,:,4)*transpose(U(:,:,4,4))) + trace(U(:,:,5,4,4)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,4,4)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,4,4)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,4,5)= trace(U(:,:,5,4,5)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,4,5)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,4,5)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,4,6)= trace(U(:,:,6,4,6)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,4,6)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,4,7)= trace(U(:,:,7,4,7)*J(:,:,7)*transpose(U(:,:,7,4))) ;


C(4,5,1)= trace(U(:,:,5,5,1)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,5,1)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,5,1)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,5,2)= trace(U(:,:,5,5,2)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,5,2)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,5,2)*J(:,:,7)*transpose(U(:,:,7,4))) ; 
C(4,5,3)= trace(U(:,:,5,5,3)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,5,3)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,5,3)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,5,4)= trace(U(:,:,5,5,4)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,5,4)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,5,4)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,5,5)= trace(U(:,:,5,5,5)*J(:,:,5)*transpose(U(:,:,5,4))) + trace(U(:,:,6,5,5)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,5,5)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,5,6)= trace(U(:,:,6,5,6)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,5,6)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,5,7)= trace(U(:,:,7,5,7)*J(:,:,7)*transpose(U(:,:,7,4))) ;

C(4,6,1)= trace(U(:,:,6,6,1)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,6,1)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,6,2)= trace(U(:,:,6,6,2)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,6,2)*J(:,:,7)*transpose(U(:,:,7,4))) ; 
C(4,6,3)= trace(U(:,:,6,6,3)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,6,3)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,6,4)= trace(U(:,:,6,6,4)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,6,4)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,6,5)= trace(U(:,:,6,6,5)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,6,5)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,6,6)= trace(U(:,:,6,6,6)*J(:,:,6)*transpose(U(:,:,6,4))) + trace(U(:,:,7,6,6)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,6,7)= trace(U(:,:,7,6,7)*J(:,:,7)*transpose(U(:,:,7,4))) ;

C(4,7,1)= trace(U(:,:,7,7,1)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,7,2)= trace(U(:,:,7,7,2)*J(:,:,7)*transpose(U(:,:,7,4))) ;  
C(4,7,3)= trace(U(:,:,7,7,3)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,7,4)= trace(U(:,:,7,7,4)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,7,5)= trace(U(:,:,7,7,5)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,7,6)= trace(U(:,:,7,7,6)*J(:,:,7)*transpose(U(:,:,7,4))) ;
C(4,7,7)= trace(U(:,:,7,7,7)*J(:,:,7)*transpose(U(:,:,7,4))) ;


C(5,1,1)= trace(U(:,:,5,1,1)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,1,1)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,1,1)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,1,2)= trace(U(:,:,5,1,2)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,1,2)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,1,2)*J(:,:,7)*transpose(U(:,:,7,5))) ;  
C(5,1,3)= trace(U(:,:,5,1,3)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,1,3)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,1,3)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,1,4)= trace(U(:,:,5,1,4)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,1,4)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,1,4)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,1,5)= trace(U(:,:,5,1,5)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,1,5)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,1,5)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,1,6)= trace(U(:,:,6,1,6)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,1,6)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,1,7)= trace(U(:,:,7,1,7)*J(:,:,7)*transpose(U(:,:,7,5))) ;

C(5,2,1)= trace(U(:,:,5,2,1)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,2,1)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,2,1)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,2,2)= trace(U(:,:,5,2,2)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,2,2)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,2,2)*J(:,:,7)*transpose(U(:,:,7,5))) ; 
C(5,2,3)= trace(U(:,:,5,2,3)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,2,3)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,2,3)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,2,4)= trace(U(:,:,5,2,4)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,2,4)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,2,4)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,2,5)= trace(U(:,:,5,2,5)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,2,5)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,2,5)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,2,6)= trace(U(:,:,6,2,6)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,2,6)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,2,7)= trace(U(:,:,7,2,7)*J(:,:,7)*transpose(U(:,:,7,5))) ;

C(5,3,1)= trace(U(:,:,5,3,1)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,3,1)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,3,1)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,3,2)= trace(U(:,:,5,3,2)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,3,2)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,3,2)*J(:,:,7)*transpose(U(:,:,7,5))) ;  
C(5,3,3)= trace(U(:,:,5,3,3)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,3,3)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,3,3)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,3,4)= trace(U(:,:,5,3,4)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,3,4)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,3,4)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,3,5)= trace(U(:,:,5,3,5)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,3,5)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,3,5)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,3,6)= trace(U(:,:,6,3,6)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,3,6)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,3,7)= trace(U(:,:,7,3,7)*J(:,:,7)*transpose(U(:,:,7,5))) ;

C(5,4,1)= trace(U(:,:,5,4,1)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,4,1)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,4,1)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,4,2)= trace(U(:,:,5,4,2)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,4,2)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,4,2)*J(:,:,7)*transpose(U(:,:,7,5))) ; 
C(5,4,3)= trace(U(:,:,5,4,3)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,4,3)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,4,3)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,4,4)= trace(U(:,:,5,4,4)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,4,4)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,4,4)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,4,5)= trace(U(:,:,5,4,5)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,4,5)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,4,5)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,4,6)= trace(U(:,:,6,4,6)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,4,6)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,4,7)= trace(U(:,:,7,4,7)*J(:,:,7)*transpose(U(:,:,7,5))) ;


C(5,5,1)= trace(U(:,:,5,5,1)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,5,1)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,5,1)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,5,2)= trace(U(:,:,5,5,2)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,5,2)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,5,2)*J(:,:,7)*transpose(U(:,:,7,5))) ; 
C(5,5,3)= trace(U(:,:,5,5,3)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,5,3)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,5,3)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,5,4)= trace(U(:,:,5,5,4)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,5,4)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,5,4)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,5,5)= trace(U(:,:,5,5,5)*J(:,:,5)*transpose(U(:,:,5,5))) + trace(U(:,:,6,5,5)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,5,5)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,5,6)= trace(U(:,:,6,5,6)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,5,6)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,5,7)= trace(U(:,:,7,5,7)*J(:,:,7)*transpose(U(:,:,7,5))) ;

C(5,6,1)= trace(U(:,:,6,6,1)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,6,1)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,6,2)= trace(U(:,:,6,6,2)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,6,2)*J(:,:,7)*transpose(U(:,:,7,5))) ; 
C(5,6,3)= trace(U(:,:,6,6,3)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,6,3)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,6,4)= trace(U(:,:,6,6,4)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,6,4)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,6,5)= trace(U(:,:,6,6,5)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,6,5)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,6,6)= trace(U(:,:,6,6,6)*J(:,:,6)*transpose(U(:,:,6,5))) + trace(U(:,:,7,6,6)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,6,7)= trace(U(:,:,7,6,7)*J(:,:,7)*transpose(U(:,:,7,5))) ;

C(5,7,1)= trace(U(:,:,7,7,1)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,7,2)= trace(U(:,:,7,7,2)*J(:,:,7)*transpose(U(:,:,7,5))) ; 
C(5,7,3)= trace(U(:,:,7,7,3)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,7,4)= trace(U(:,:,7,7,4)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,7,5)= trace(U(:,:,7,7,5)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,7,6)= trace(U(:,:,7,7,6)*J(:,:,7)*transpose(U(:,:,7,5))) ;
C(5,7,7)= trace(U(:,:,7,7,7)*J(:,:,7)*transpose(U(:,:,7,5))) ;

C(6,1,1)= trace(U(:,:,6,1,1)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,1,1)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,1,2)= trace(U(:,:,6,1,2)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,1,2)*J(:,:,7)*transpose(U(:,:,7,6))) ; 
C(6,1,3)= trace(U(:,:,6,1,3)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,1,3)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,1,4)= trace(U(:,:,6,1,4)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,1,4)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,1,5)= trace(U(:,:,6,1,5)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,1,5)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,1,6)= trace(U(:,:,6,1,6)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,1,6)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,1,7)= trace(U(:,:,7,1,7)*J(:,:,7)*transpose(U(:,:,7,6))) ;

C(6,2,1)= trace(U(:,:,6,2,1)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,2,1)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,2,2)= trace(U(:,:,6,2,2)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,2,2)*J(:,:,7)*transpose(U(:,:,7,6))) ;  
C(6,2,3)= trace(U(:,:,6,2,3)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,2,3)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,2,4)= trace(U(:,:,6,2,4)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,2,4)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,2,5)= trace(U(:,:,6,2,5)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,2,5)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,2,6)= trace(U(:,:,6,2,6)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,2,6)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,2,7)= trace(U(:,:,7,2,7)*J(:,:,7)*transpose(U(:,:,7,6))) ;

C(6,3,1)= trace(U(:,:,6,3,1)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,3,1)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,3,2)= trace(U(:,:,6,3,2)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,3,2)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,3,3)= trace(U(:,:,6,3,3)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,3,3)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,3,4)= trace(U(:,:,6,3,4)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,3,4)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,3,5)= trace(U(:,:,6,3,5)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,3,5)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,3,6)= trace(U(:,:,6,3,6)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,3,6)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,3,7)= trace(U(:,:,7,3,7)*J(:,:,7)*transpose(U(:,:,7,6))) ;

C(6,4,1)= trace(U(:,:,6,4,1)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,4,1)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,4,2)= trace(U(:,:,6,4,2)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,4,2)*J(:,:,7)*transpose(U(:,:,7,6))) ; 
C(6,4,3)= trace(U(:,:,6,4,3)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,4,3)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,4,4)= trace(U(:,:,6,4,4)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,4,4)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,4,5)= trace(U(:,:,6,4,5)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,4,5)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,4,6)= trace(U(:,:,6,4,6)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,4,6)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,4,7)= trace(U(:,:,7,4,7)*J(:,:,7)*transpose(U(:,:,7,6))) ;


C(6,5,1)= trace(U(:,:,6,5,1)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,5,1)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,5,2)= trace(U(:,:,6,5,2)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,5,2)*J(:,:,7)*transpose(U(:,:,7,6))) ; 
C(6,5,3)= trace(U(:,:,6,5,3)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,5,3)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,5,4)= trace(U(:,:,6,5,4)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,5,4)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,5,5)= trace(U(:,:,6,5,5)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,5,5)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,5,6)= trace(U(:,:,6,5,6)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,5,6)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,5,7)= trace(U(:,:,7,5,7)*J(:,:,7)*transpose(U(:,:,7,6))) ;

C(6,6,1)= trace(U(:,:,6,6,1)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,6,1)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,6,2)= trace(U(:,:,6,6,2)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,6,2)*J(:,:,7)*transpose(U(:,:,7,6))) ; 
C(6,6,3)= trace(U(:,:,6,6,3)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,6,3)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,6,4)= trace(U(:,:,6,6,4)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,6,4)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,6,5)= trace(U(:,:,6,6,5)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,6,5)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,6,6)= trace(U(:,:,6,6,6)*J(:,:,6)*transpose(U(:,:,6,6))) + trace(U(:,:,7,6,6)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,6,7)= trace(U(:,:,7,6,7)*J(:,:,7)*transpose(U(:,:,7,6))) ;

C(6,7,1)= trace(U(:,:,7,7,1)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,7,2)= trace(U(:,:,7,7,2)*J(:,:,7)*transpose(U(:,:,7,6))) ;  
C(6,7,3)= trace(U(:,:,7,7,3)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,7,4)= trace(U(:,:,7,7,4)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,7,5)= trace(U(:,:,7,7,5)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,7,6)= trace(U(:,:,7,7,6)*J(:,:,7)*transpose(U(:,:,7,6))) ;
C(6,7,7)= trace(U(:,:,7,7,7)*J(:,:,7)*transpose(U(:,:,7,6))) ;

C(7,1,1)= trace(U(:,:,7,1,1)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,1,2)= trace(U(:,:,7,1,2)*J(:,:,7)*transpose(U(:,:,7,7))) ; 
C(7,1,3)= trace(U(:,:,7,1,3)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,1,4)= trace(U(:,:,7,1,4)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,1,5)= trace(U(:,:,7,1,5)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,1,6)= trace(U(:,:,7,1,6)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,1,7)= trace(U(:,:,7,1,7)*J(:,:,7)*transpose(U(:,:,7,7))) ;

C(7,2,1)= trace(U(:,:,7,2,1)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,2,2)= trace(U(:,:,7,2,2)*J(:,:,7)*transpose(U(:,:,7,7))) ; 
C(7,2,3)= trace(U(:,:,7,2,3)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,2,4)= trace(U(:,:,7,2,4)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,2,5)= trace(U(:,:,7,2,5)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,2,6)= trace(U(:,:,7,2,6)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,2,7)= trace(U(:,:,7,2,7)*J(:,:,7)*transpose(U(:,:,7,7))) ;

C(7,3,1)= trace(U(:,:,7,3,1)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,3,2)= trace(U(:,:,7,3,2)*J(:,:,7)*transpose(U(:,:,7,7))) ;  
C(7,3,3)= trace(U(:,:,7,3,3)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,3,4)= trace(U(:,:,7,3,4)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,3,5)= trace(U(:,:,7,3,5)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,3,6)= trace(U(:,:,7,3,6)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,3,7)= trace(U(:,:,7,3,7)*J(:,:,7)*transpose(U(:,:,7,7))) ;

C(7,4,1)= trace(U(:,:,7,4,1)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,4,2)= trace(U(:,:,7,4,2)*J(:,:,7)*transpose(U(:,:,7,7))) ;  
C(7,4,3)= trace(U(:,:,7,4,3)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,4,4)= trace(U(:,:,7,4,4)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,4,5)= trace(U(:,:,7,4,5)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,4,6)= trace(U(:,:,7,4,6)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,4,7)= trace(U(:,:,7,4,7)*J(:,:,7)*transpose(U(:,:,7,7))) ;


C(7,5,1)= trace(U(:,:,7,5,1)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,5,2)= trace(U(:,:,7,5,2)*J(:,:,7)*transpose(U(:,:,7,7))) ;  
C(7,5,3)= trace(U(:,:,7,5,3)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,5,4)= trace(U(:,:,7,5,4)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,5,5)= trace(U(:,:,7,5,5)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,5,6)= trace(U(:,:,7,5,6)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,5,7)= trace(U(:,:,7,5,7)*J(:,:,7)*transpose(U(:,:,7,7))) ;

C(7,6,1)= trace(U(:,:,7,6,1)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,6,2)= trace(U(:,:,7,6,2)*J(:,:,7)*transpose(U(:,:,7,7))) ;  
C(7,6,3)= trace(U(:,:,7,6,3)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,6,4)= trace(U(:,:,7,6,4)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,6,5)= trace(U(:,:,7,6,5)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,6,6)= trace(U(:,:,7,6,6)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,6,7)= trace(U(:,:,7,6,7)*J(:,:,7)*transpose(U(:,:,7,7))) ;

C(7,7,1)= trace(U(:,:,7,7,1)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,7,2)= trace(U(:,:,7,7,2)*J(:,:,7)*transpose(U(:,:,7,7))) ;  
C(7,7,3)= trace(U(:,:,7,7,3)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,7,4)= trace(U(:,:,7,7,4)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,7,5)= trace(U(:,:,7,7,5)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,7,6)= trace(U(:,:,7,7,6)*J(:,:,7)*transpose(U(:,:,7,7))) ;
C(7,7,7)= trace(U(:,:,7,7,7)*J(:,:,7)*transpose(U(:,:,7,7))) ;




Co(1)= C(1,1,1)*qd(1)*qd(1)+C(1,2,2)*qd(2)*qd(2)+C(1,3,3)*qd(3)*qd(3)+C(1,4,4)*qd(4)*qd(4)+ C(1,5,5)*qd(5)*qd(5)+C(1,6,6)*qd(6)*qd(6)+C(1,7,7)*qd(7)*qd(7)+2*(C(1,1,2)*qd(1)*qd(2)+ C(1,1,3)*qd(1)*qd(3)+ C(1,1,4)*qd(1)*qd(4)+ C(1,1,5)*qd(1)*qd(5)+ C(1,1,6)*qd(1)*qd(6)+ C(1,1,7)*qd(1)*qd(7)+ C(1,2,3)*qd(2)*qd(3)+ C(1,2,4)*qd(2)*qd(4)+ C(1,2,5)*qd(2)*qd(5)+ C(1,2,6)*qd(2)*qd(6)+ C(1,2,7)*qd(2)*qd(7)+ C(1,3,4)*qd(3)*qd(4)+ C(1,3,5)*qd(3)*qd(5)+ C(1,3,6)*qd(3)*qd(6)+ C(1,3,7)*qd(3)*qd(7)+ C(1,4,5)*qd(4)*qd(5)+ C(1,4,6)*qd(4)*qd(6)+ C(1,4,7)*qd(4)*qd(7)+ C(1,5,6)*qd(5)*qd(6)+ C(1,5,7)*qd(5)*qd(7)+  C(1,6,7)*qd(7)*qd(7));

Co(2)= C(2,1,1)*qd(1)*qd(1)+C(2,2,2)*qd(2)*qd(2)+C(2,3,3)*qd(3)*qd(3)+C(2,4,4)*qd(4)*qd(4)+ C(2,5,5)*qd(5)*qd(5)+C(2,6,6)*qd(6)*qd(6)+C(2,7,7)*qd(7)*qd(7)+2*(C(2,1,2)*qd(1)*qd(2)+ C(2,1,3)*qd(1)*qd(3)+ C(2,1,4)*qd(1)*qd(4)+ C(2,1,5)*qd(1)*qd(5)+ C(2,1,6)*qd(1)*qd(6)+ C(2,1,7)*qd(1)*qd(7)+ C(2,2,3)*qd(2)*qd(3)+ C(2,2,4)*qd(2)*qd(4)+ C(2,2,5)*qd(2)*qd(5)+ C(2,2,6)*qd(2)*qd(6)+ C(2,2,7)*qd(2)*qd(7)+ C(2,3,4)*qd(3)*qd(4)+ C(2,3,5)*qd(3)*qd(5)+ C(2,3,6)*qd(3)*qd(6)+ C(2,3,7)*qd(3)*qd(7)+ C(2,4,5)*qd(4)*qd(5)+ C(2,4,6)*qd(4)*qd(6)+ C(2,4,7)*qd(4)*qd(7)+ C(2,5,6)*qd(5)*qd(6)+ C(2,5,7)*qd(5)*qd(7)+  C(2,6,7)*qd(7)*qd(7));

Co(3)= C(3,1,1)*qd(1)*qd(1)+C(3,2,2)*qd(2)*qd(2)+C(3,3,3)*qd(3)*qd(3)+C(3,4,4)*qd(4)*qd(4)+ C(3,5,5)*qd(5)*qd(5)+C(3,6,6)*qd(6)*qd(6)+C(3,7,7)*qd(7)*qd(7)+2*(C(3,1,2)*qd(1)*qd(2)+ C(3,1,3)*qd(1)*qd(3)+ C(3,1,4)*qd(1)*qd(4)+ C(3,1,5)*qd(1)*qd(5)+ C(3,1,6)*qd(1)*qd(6)+ C(3,1,7)*qd(1)*qd(7)+ C(3,2,3)*qd(2)*qd(3)+ C(3,2,4)*qd(2)*qd(4)+ C(3,2,5)*qd(2)*qd(5)+ C(3,2,6)*qd(2)*qd(6)+ C(3,2,7)*qd(2)*qd(7)+ C(3,3,4)*qd(3)*qd(4)+ C(3,3,5)*qd(3)*qd(5)+ C(3,3,6)*qd(3)*qd(6)+ C(3,3,7)*qd(3)*qd(7)+ C(3,4,5)*qd(4)*qd(5)+ C(3,4,6)*qd(4)*qd(6)+ C(3,4,7)*qd(4)*qd(7)+ C(3,5,6)*qd(5)*qd(6)+ C(3,5,7)*qd(5)*qd(7)+  C(3,6,7)*qd(7)*qd(7));

Co(4)= C(4,1,1)*qd(1)*qd(1)+C(4,2,2)*qd(2)*qd(2)+C(4,3,3)*qd(3)*qd(3)+C(4,4,4)*qd(4)*qd(4)+ C(4,5,5)*qd(5)*qd(5)+C(4,6,6)*qd(6)*qd(6)+C(4,7,7)*qd(7)*qd(7)+2*(C(4,1,2)*qd(1)*qd(2)+ C(4,1,3)*qd(1)*qd(3)+ C(4,1,4)*qd(1)*qd(4)+ C(4,1,5)*qd(1)*qd(5)+ C(4,1,6)*qd(1)*qd(6)+ C(4,1,7)*qd(1)*qd(7)+ C(4,2,3)*qd(2)*qd(3)+ C(4,2,4)*qd(2)*qd(4)+ C(4,2,5)*qd(2)*qd(5)+ C(4,2,6)*qd(2)*qd(6)+ C(4,2,7)*qd(2)*qd(7)+ C(4,3,4)*qd(3)*qd(4)+ C(4,3,5)*qd(3)*qd(5)+ C(4,3,6)*qd(3)*qd(6)+ C(4,3,7)*qd(3)*qd(7)+ C(4,4,5)*qd(4)*qd(5)+ C(4,4,6)*qd(4)*qd(6)+ C(4,4,7)*qd(4)*qd(7)+ C(4,5,6)*qd(5)*qd(6)+ C(4,5,7)*qd(5)*qd(7)+  C(4,6,7)*qd(7)*qd(7));

Co(5)= C(5,1,1)*qd(1)*qd(1)+C(5,2,2)*qd(2)*qd(2)+C(5,3,3)*qd(3)*qd(3)+C(5,4,4)*qd(4)*qd(4)+ C(5,5,5)*qd(5)*qd(5)+C(5,6,6)*qd(6)*qd(6)+C(5,7,7)*qd(7)*qd(7)+2*(C(5,1,2)*qd(1)*qd(2)+ C(5,1,3)*qd(1)*qd(3)+ C(5,1,4)*qd(1)*qd(4)+ C(5,1,5)*qd(1)*qd(5)+ C(5,1,6)*qd(1)*qd(6)+ C(5,1,7)*qd(1)*qd(7)+ C(5,2,3)*qd(2)*qd(3)+ C(5,2,4)*qd(2)*qd(4)+ C(5,2,5)*qd(2)*qd(5)+ C(5,2,6)*qd(2)*qd(6)+ C(5,2,7)*qd(2)*qd(7)+ C(5,3,4)*qd(3)*qd(4)+ C(5,3,5)*qd(3)*qd(5)+ C(5,3,6)*qd(3)*qd(6)+ C(5,3,7)*qd(3)*qd(7)+ C(5,4,5)*qd(4)*qd(5)+ C(5,4,6)*qd(4)*qd(6)+ C(5,4,7)*qd(4)*qd(7)+ C(5,5,6)*qd(5)*qd(6)+ C(5,5,7)*qd(5)*qd(7)+  C(5,6,7)*qd(7)*qd(7));

Co(6)= C(6,1,1)*qd(1)*qd(1)+C(6,2,2)*qd(2)*qd(2)+C(6,3,3)*qd(3)*qd(3)+C(6,4,4)*qd(4)*qd(4)+ C(6,5,5)*qd(5)*qd(5)+C(6,6,6)*qd(6)*qd(6)+C(6,7,7)*qd(7)*qd(7)+2*(C(6,1,2)*qd(1)*qd(2)+ C(6,1,3)*qd(1)*qd(3)+ C(6,1,4)*qd(1)*qd(4)+ C(6,1,5)*qd(1)*qd(5)+ C(6,1,6)*qd(1)*qd(6)+ C(6,1,7)*qd(1)*qd(7)+ C(6,2,3)*qd(2)*qd(3)+ C(6,2,4)*qd(2)*qd(4)+ C(6,2,5)*qd(2)*qd(5)+ C(6,2,6)*qd(2)*qd(6)+ C(6,2,7)*qd(2)*qd(7)+ C(6,3,4)*qd(3)*qd(4)+ C(6,3,5)*qd(3)*qd(5)+ C(6,3,6)*qd(3)*qd(6)+ C(6,3,7)*qd(3)*qd(7)+ C(6,4,5)*qd(4)*qd(5)+ C(6,4,6)*qd(4)*qd(6)+ C(6,4,7)*qd(4)*qd(7)+ C(6,5,6)*qd(5)*qd(6)+ C(6,5,7)*qd(5)*qd(7)+  C(6,6,7)*qd(7)*qd(7));

Co(7)= C(7,1,1)*qd(1)*qd(1)+C(7,2,2)*qd(2)*qd(2)+C(7,3,3)*qd(3)*qd(3)+C(7,4,4)*qd(4)*qd(4)+ C(7,5,5)*qd(5)*qd(5)+C(7,6,6)*qd(6)*qd(6)+C(7,7,7)*qd(7)*qd(7)+2*(C(7,1,2)*qd(1)*qd(2)+ C(7,1,3)*qd(1)*qd(3)+ C(7,1,4)*qd(1)*qd(4)+ C(7,1,5)*qd(1)*qd(5)+ C(7,1,6)*qd(1)*qd(6)+ C(7,1,7)*qd(1)*qd(7)+ C(7,2,3)*qd(2)*qd(3)+ C(7,2,4)*qd(2)*qd(4)+ C(7,2,5)*qd(2)*qd(5)+ C(7,2,6)*qd(2)*qd(6)+ C(7,2,7)*qd(2)*qd(7)+ C(7,3,4)*qd(3)*qd(4)+ C(7,3,5)*qd(3)*qd(5)+ C(7,3,6)*qd(3)*qd(6)+ C(7,3,7)*qd(3)*qd(7)+ C(7,4,5)*qd(4)*qd(5)+ C(7,4,6)*qd(4)*qd(6)+ C(7,4,7)*qd(4)*qd(7)+ C(7,5,6)*qd(5)*qd(6)+ C(7,5,7)*qd(5)*qd(7)+  C(7,6,7)*qd(7)*qd(7));

 xd = [qd;-inv(D+diag([0.20519,0.094428,0.094428,0.03,0.001,0.001,0.0003]))*(transpose(G)+bq+ transpose(Co))] + [zeros(7,7);inv(D+diag([0.20519,0.094428,0.094428,0.03,0.001,0.001,0.0003]))]*tau;
x= xd*0.002 + [q;qd];
    
    
    
    
    
    
    
end 


function bq = frictionComp(qd)
%parameters and model from paper http://homepages.inf.ed.ac.uk/svijayak/publications/mitrovic-ICRA2010.pdf
%Optimal Feedback Control for Anthropomorphic Manipulators
%Djordje Mitrovic, Sho Nagashima, Stefan Klanke, Takamitsu Matsubara, Sethu Vijayakumar
%ICRA 2010


s=20;
bc = [2.516; 2.581; 2.038; 0.956; 0.323; 0.315; 0.066];
B =  [1.142; 0.946; 0.309; 0.255; 0.025; 0.039; 0.004]';

bq = bc.*atan(s*qd)*2/pi+B.*qd;
end 

 function T = getTransformDH(a,d,alpha,q)
    ct = cos(q);
    st = sin(q);
    cb = cos(alpha);
    sb = sin(alpha);
    
    T = [ ct, -st*cb,  st*sb, a*ct;
          st,  ct*cb, -ct*sb, a*st;
          0, sb, cb, d;
          0, 0, 0, 1 ];            
 end       